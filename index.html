<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <link rel="icon" href="12345.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>像素偵探</title>

    <style>
        /* --- CSS 變數：方便調整 --- */
        :root {
            --grid-size: 2; 
            --square-gap: 5px; 
            --container-width: 90vmin; 
        }

        body {
            /* 修正：確保內容垂直堆疊並置中 (解決排版問題) */
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            
            /* === 背景圖片設定 (使用您的 11111.png) === */
            background-image: url('11111.png'); 
            background-size: cover;             
            background-repeat: no-repeat;       
            background-attachment: fixed;       
            
            font-family: Arial, sans-serif;
        }

        .container {
            width: var(--container-width);
            text-align: center;
            /* 讓遊戲內容在圖片背景上更清晰 */
            background-color: rgba(255, 255, 255, 0.9); 
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        /* --- 標頭 (分數/關卡) 樣式 --- */
        .header {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 1.2em;
            font-weight: bold;
            color: #333;
        }

        /* --- 遊戲網格樣式 --- */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(var(--grid-size), 1fr); 
            gap: var(--square-gap);
            width: 100%;
            aspect-ratio: 1 / 1; 
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* --- 單個顏色方塊樣式 --- */
        .square {
            cursor: pointer;
            transition: transform 0.1s ease-out; 
        }

        .square:hover {
            transform: scale(0.98);
        }

        /* --- 遊戲結束訊息樣式 --- */
        #game-over {
            margin-top: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }

        #game-over button {
            padding: 10px 20px;
            margin-top: 15px;
            font-size: 1em;
            cursor: pointer;
            background-color: #4CAF50; 
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <span id="score">分數: 0</span>
            <span id="level">關卡: 1</span>
        </div>
        
        <div id="game-grid" class="game-grid">
        </div>

        <div id="game-over" class="hidden">
            <h2>挑戰結束！</h2>
            <p>您的最終分數是: <span id="final-score">0</span></p>
            <button onclick="startGame()">重新開始</button>
        </div>
    </div>

    <script>
        // --- 宣告變數 ---
        let score = 0;
        let level = 1;
        let gridSize = 2; 
        let colorDifference = 50; 
        
        // 已移除計時器和音效相關變數
        const gameGrid = document.getElementById('game-grid');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');
        

        // --- 輔助函式：生成隨機數 ---
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // --- 核心函式：生成 HSL 顏色字串 ---
        function HSL(h, s, l) {
            return `hsl(${h}, ${s}%, ${l}%)`;
        }

        // --- 顏色差異邏輯：生成遊戲盤 ---
        function generateColors() {
            const hue = getRandomInt(0, 360);
            const saturation = getRandomInt(70, 100);
            const light = getRandomInt(40, 70);

            const baseColor = HSL(hue, saturation, light);

            let targetLight;
            if (Math.random() > 0.5) {
                targetLight = Math.min(100, light + colorDifference);
            } else {
                targetLight = Math.max(0, light - colorDifference);
            }

            const targetColor = HSL(hue, saturation, targetLight);
            const targetIndex = getRandomInt(0, gridSize * gridSize - 1);

            return { baseColor, targetColor, targetIndex };
        }
        
        // --- 渲染遊戲盤面 ---
        function renderGrid() {
            // 無時間限制，無需計時器控制
            
            gameOverScreen.classList.add('hidden');
            gameGrid.classList.remove('hidden');

            gameGrid.innerHTML = '';
            gameGrid.style.setProperty('--grid-size', gridSize); 
            
            const { baseColor, targetColor, targetIndex } = generateColors();
            
            for (let i = 0; i < gridSize * gridSize; i++) {
                const square = document.createElement('div');
                square.classList.add('square');
                
                const isTarget = (i === targetIndex);
                
                square.style.backgroundColor = isTarget ? targetColor : baseColor;
                
                // 點擊事件綁定
                square.onclick = () => handleSquareClick(isTarget);
                
                gameGrid.appendChild(square);
            }
        }

        // --- 處理方塊點擊事件 ---
        function handleSquareClick(isTarget) {
            if (isTarget) {
                // 點擊正確：進入下一關，無時間重設
                score++;
                level++;
                updateDifficulty(); 
                renderGrid(); 
            } else {
                // 點擊錯誤：遊戲結束
                endGame();
            }
            
            // 更新分數顯示 
            scoreDisplay.textContent = `分數: ${score}`;
            levelDisplay.textContent = `關卡: ${level}`;
        }

        // --- 難度更新邏輯 ---
        function updateDifficulty() {
            // 1. 每 3 關增加一次網格大小
            if (level % 3 === 1 && gridSize < 8) { 
                gridSize++;
            }

            // 2. 顏色差異逐漸減少 (難度增加)
            if (colorDifference > 5) {
                colorDifference -= 3; 
            }
        }
        
        // --- 遊戲結束函式 ---
        function endGame() {
            // 無音效播放
            // 顯示遊戲結束畫面
            gameGrid.classList.add('hidden');
            gameOverScreen.classList.remove('hidden');
            finalScoreDisplay.textContent = score;
        }

        // --- 遊戲初始化/重新開始 ---
        function startGame() {
            // 重置所有參數
            score = 0;
            level = 1;
            gridSize = 2;
            colorDifference = 50;
            
            scoreDisplay.textContent = `分數: 0`;
            levelDisplay.textContent = `關卡: 1`;

            renderGrid();
        }

        // 啟動遊戲
        startGame();
    </script>
</body>
</html>
